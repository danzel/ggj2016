!function(t){function i(s){if(e[s])return e[s].exports;var a=e[s]={exports:{},id:s,loaded:!1};return t[s].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){var s=e(1),a=e(9),o=e(10),r=e(12),n=e(29),h=function(){function t(){this.game=new Phaser.Game(1280,720,Phaser.AUTO,"",this,!1,!0,null)}return t.prototype.preload=function(){this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,a.load(this.game)},t.prototype.create=function(){s.oneTimeInit(this.game),this.game.input.gamepad.start(),this.music=this.game.add.audio("music",1,!0),this.music.play(),this.current="splash",this.activeState=new n(this.game)},t.prototype.update=function(){var t=this.activeState.update();if(t!=this.current){switch(t){case"splash":this.activeState=new n(this.game);break;case"controls":this.activeState=new o(this.game);break;case"game":this.activeState=new r(this.game)}this.current=t}},t}();new h},function(t,i,e){var s=e(2),a=e(4),o=e(5),r=e(6),n=e(8),h=function(){function t(){}return t.oneTimeInit=function(t){this.game=t,this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.setImpactEvents(!0),this.game.physics.p2.restitution=.8,this.lambCollisionGroup=t.physics.p2.createCollisionGroup(),this.playerCollisionGroup=t.physics.p2.createCollisionGroup(),this.pitCollisionGroup=t.physics.p2.createCollisionGroup(),this.groundCreatureCollisionGroup=t.physics.p2.createCollisionGroup(),this.flyingCreatureCollisionGroup=t.physics.p2.createCollisionGroup(),this.flyingSensorCollisionGroup=t.physics.p2.createCollisionGroup(),this.game.physics.p2.updateBoundsCollisionGroup(),o.init(this.game),this.soundscape=new n(this.game)},t.init=function(){this.lambSacrificed=new a,this.gameObjects.length=0,this.shots.length=0,this.layerGround=this.game.add.group(),this.layerFlying=this.game.add.group(),this.layerUi=this.game.add.group(),this.bloodSplatters=new s(this.game),this.souls=new r(this.game)},t.tidyUpMaybe=function(){for(var t=0;t<this.gameObjects.length;t++){this.gameObjects[t].sprite.destroy();var i=this.gameObjects[t];if(i.circleBody&&i.circleBody.removeFromWorld(),i.targetSpring&&this.game.physics.p2.removeSpring(i.targetSpring),i.springs)for(var e=i.springs,s=0;s<e.length;s++)this.game.physics.p2.removeSpring(e[s])}this.layerGround.destroy(),this.layerFlying.destroy()},t.removeStuff=function(){this.layerGround.destroy(),this.layerFlying.destroy(),this.layerUi.destroy(),this.bloodSplatters.reset()},t.addBloodSplatter=function(t,i,e,s){this.bloodSplatters.add(t,i,e,s)},t.addSoul=function(t,i,e){this.souls.add(t,i,e)},t.gameObjects=[],t.shots=[],t}();t.exports=h},function(t,i,e){var s=e(3),a=function(){function t(t){this.bloodSplatters=[],this.game=t}return t.prototype.add=function(t,i,e,a){this.bloodSplatters.length>=100||this.bloodSplatters.push(new s(this.game,t,i,this,e,a))},t.prototype.remove=function(t){var i=this.bloodSplatters.indexOf(t);this.bloodSplatters.splice(i,1)},t.prototype.reset=function(){for(var t=0;t<this.bloodSplatters.length;t++)this.bloodSplatters[t].destroyEmitter()},t}();t.exports=a},function(t,i){var e=function(){function t(t,i,e,s,a,o){this.owner=s,this.emitter=t.add.emitter(i,e,o),this.emitter.makeParticles("blood"),this.emitter.setAlpha(0,1,a,function(t){return 1-t*t}),this.emitter.start(!0,a,null,o),t.time.events.add(a,this.destroyEmitter,this)}return t.prototype.destroyEmitter=function(){this.emitter.destroy(),this.owner.remove(this)},t}();t.exports=e},function(t,i){var e=function(){function t(){this.handlers=[]}return t.prototype.on=function(t){this.handlers.push(t)},t.prototype.off=function(t){this.handlers=this.handlers.filter(function(i){return i!==t})},t.prototype.trigger=function(t){this.handlers.slice(0).forEach(function(i){return i(t)})},t}();t.exports=e},function(t,i){var e=function(){function t(){}return t.init=function(i){t.groundUnitMaterial=i.physics.p2.createMaterial("groundUnitMaterial"),i.physics.p2.createContactMaterial(t.groundUnitMaterial,t.groundUnitMaterial,{friction:1,restitution:0,stiffness:1e7,relaxation:4,frictionStiffness:1e7,frictionRelaxation:5,surfaceVelocity:0})},t}();t.exports=e},function(t,i,e){var s=e(7),a=function(){function t(t){this.game=t,this.souls=[]}return t.prototype.add=function(t,i,e){this.souls.push(new s(this.game,t,i,e))},t.prototype.reset=function(){for(var t=0;t<this.souls.length;t++)this.souls[t].complete()},t}();t.exports=a},function(t,i){var e=function(){function t(t,i,e,s){this.sprite=t.add.sprite(i,e,"soul");var a=t.add.tween(this.sprite).to({y:-50},450,function(t){return Math.pow(t,1.9)},!0);a.onComplete.add(this.complete,this);var o=i+(2==s?-25:25);t.add.tween(this.sprite).to({x:o},450,function(t){return Math.sin(t*Math.PI*2)},!0),this.emitter=t.add.emitter(i,e,10),this.emitter.makeParticles("soul"),this.emitter.alpha=.1,this.emitter.start(!1,100,50),t.add.tween(this.emitter).to({y:-50},450,function(t){return Math.pow(t,1.9)},!0),t.add.tween(this.emitter).to({x:o},450,function(t){return Math.sin(t*Math.PI*2)},!0)}return t.prototype.complete=function(){this.sprite.destroy(),this.emitter.destroy()},t}();t.exports=e},function(t,i){var e=function(){function t(t){this.game=t,this.screamEnabled=!0,this.attackEnabled=!0,t.time.events.add(500*Math.random()+500,this.demonSound,this)}return t.prototype.addScream=function(){if(this.screamEnabled){var t=this.game.add.audio("scream"+Math.floor(5*Math.random()));t.play(),this.screamEnabled=!1,this.game.time.events.add(4500*Math.random()+400,this.resetScreamSound,this)}},t.prototype.resetScreamSound=function(){this.screamEnabled=!0},t.prototype.addAttack=function(){if(this.attackEnabled){var t=this.game.add.audio("attack"+Math.floor(4*Math.random()),.3);t.play(),this.attackEnabled=!1,this.game.time.events.add(700*Math.random()+100,this.resetAttackSound,this)}},t.prototype.resetAttackSound=function(){this.attackEnabled=!0},t.prototype.demonSound=function(){this.game.time.events.add(5e3*Math.random()+200,this.demonSound,this);var t=this.game.add.audio("demon"+Math.floor(5*Math.random()));t.play()},t}();t.exports=e},function(t,i){var e=function(){function t(){}return t.load=function(t){t.load.image("bg","img/bg2.jpg"),t.load.image("sheeple","img/sheeple.png"),t.load.image("soul","img/soul.png"),t.load.spritesheet("altar1","img/creeps/t1-altar-a.png",64,96),t.load.spritesheet("player1","img/creeps/t1-monarch-a.png",92,64),t.load.image("warrior1","img/creeps/t1-warrior.png"),t.load.image("tank1","img/creeps/t1-tank.png"),t.load.image("flying1","img/creeps/t1-harpy.png"),t.load.image("harvester1","img/creeps/t1-thrall.png"),t.load.image("spam1","img/creeps/t1-shoal.png"),t.load.image("thrower1","img/creeps/t1-thrower.png"),t.load.spritesheet("altar2","img/creeps/t2-altar-a.png",64,96),t.load.spritesheet("player2","img/creeps/t2-monarch-a.png",92,64),t.load.image("warrior2","img/creeps/t2-warrior.png"),t.load.image("tank2","img/creeps/t2-tank.png"),t.load.image("flying2","img/creeps/t2-harpy.png"),t.load.image("harvester2","img/creeps/t2-thrall.png"),t.load.image("spam2","img/creeps/t2-shoal.png"),t.load.image("thrower2","img/creeps/t2-thrower.png"),t.load.image("shadow-flying","img/shadows/harpy.png"),t.load.image("shadow-player","img/shadows/monarch.png"),t.load.image("shadow-spam","img/shadows/shoal.png"),t.load.image("shadow-tank","img/shadows/tank.png"),t.load.image("shadow-harvester","img/shadows/thrall.png"),t.load.image("shadow-thrower","img/shadows/thrower.png"),t.load.image("shadow-warrior","img/shadows/warrior.png"),t.load.image("blood","img/blood.png"),t.load.image("shot","img/shot.png"),t.load.image("selector1","img/t1-selector.png"),t.load.image("selector2","img/t2-selector.png"),t.load.spritesheet("sheeple-new","img/sheeple-new.png",32,48,12),t.load.image("shadow-sheeple","img/shadows/sheeple.png"),t.load.image("splash","img/splash.jpg"),t.load.image("controls","img/controls.jpg"),t.load.image("win1","img/win1.png"),t.load.image("win2","img/win2.png"),t.load.image("healthmanabg1","img/healthmanabg1.png"),t.load.image("healthmanabg2","img/healthmanabg2.png"),t.load.image("healthbar","img/healthbar.png"),t.load.image("manabar","img/manabar.png"),t.load.audio("music","audio/NextofKinNotifiedWIP4.mp3"),t.load.audio("scream0","audio/scream/9432__thanvannispen__male-thijs-loud-scream.wav"),t.load.audio("scream1","audio/scream/42847__freqman__psycho-scream-1.wav"),t.load.audio("scream2","audio/scream/50776__smcameron__fall-with-impact.ogg"),t.load.audio("scream3","audio/scream/58793__syna-max__death-scream.wav"),t.load.audio("scream4","audio/scream/235591__tcrocker68__girl-scream-followingscreams.wav"),t.load.audio("demon0","audio/demon/213509__soykevin__zombie-attack.wav"),t.load.audio("demon1","audio/demon/85568__joelaudio__dragon-roar.wav"),t.load.audio("demon2","audio/demon/48688__sea-fury__monster-4.wav"),t.load.audio("demon3","audio/demon/49127__aesqe__monster-growl-01.wav"),t.load.audio("demon4","audio/demon/50881__gabemiller74__werewolf.wav"),t.load.audio("attack0","audio/attack/44203__zolopher__splat_0.wav"),t.load.audio("attack1","audio/attack/54807__mwl500__good-kick-in-the-head-sound.wav"),t.load.audio("attack2","audio/attack/89769__cgeffex__fist-punch-3.wav"),t.load.audio("attack3","audio/attack/118513__thefsoundman__punch-02.wav")},t}();t.exports=e},function(t,i,e){var s=e(11),a=function(){function t(t){this.game=t,this.sprite=t.add.sprite(0,0,"controls"),this.createText(),this.initialTextWidth=this.text.width}return t.prototype.createText=function(){this.text=new Phaser.Text(this.game,640,600,"Press Start to Play",{font:"30pt MetalMacabre,fantasy",boundsAlignH:"center",stroke:"white",strokeThickness:6}),this.text.setTextBounds(0,0,0,100),this.sprite.addChild(this.text);var t=this.game.add.tween(this.text.scale).to({x:1.2,y:1.2},500,Phaser.Easing.Cubic.InOut,!1,0,-1,!0);t.start()},t.prototype.update=function(){var t=this.game.input.gamepad.pad1.connected&&this.game.input.gamepad.pad1.getButton(Phaser.Gamepad.XBOX360_START).isDown||this.game.input.gamepad.pad2.connected&&this.game.input.gamepad.pad2.getButton(Phaser.Gamepad.XBOX360_START).isDown;return t&&!s.startDown?(s.startDown=t,"game"):(s.startDown=t,"controls")},t}();t.exports=a},function(t,i){var e=function(){function t(){}return t}();t.exports=e},function(t,i,e){var s=e(13),a=e(1),o=e(14),r=e(15),n=e(26),h=e(27),p=e(11),l=function(){function t(t){this.players=[],this.sacrificePits=[],this.swapButtonDown=!1,this.lastSpawn=0,this.game=t,this.game.add.sprite(0,0,"bg"),a.init(),this.game.input.gamepad.start(),this.players.push(new r(this.game,1,this.game.input.gamepad.pad1,this.game.input.gamepad.pad2)),this.players.push(new r(this.game,2,this.game.input.gamepad.pad2,this.game.input.gamepad.pad1)),this.sacrificePits.push(new n(this.game,this.players[0])),this.sacrificePits.push(new n(this.game,this.players[1])),a.gameObjects.push(this.players[0],this.players[1],this.sacrificePits[0],this.sacrificePits[1]);for(var i=0;100>i;i++)a.gameObjects.push(new o(this.game,200+880*Math.random(),720*Math.random()));this.ui=new h(this.game,this.players),this.ggHandler=new s(t,this.players)}return t.prototype.update=function(){for(var t=0;t<a.gameObjects.length;t++)a.gameObjects[t].sprite.alive?a.gameObjects[t].update():a.gameObjects.splice(t,1);for(var t=a.shots.length-1;t>=0;t--)a.shots[t].update();if(this.ui.update(),this.ggHandler.update(),this.game.input.gamepad.pad1.connected&&(this.game.input.gamepad.pad1.getButton(Phaser.Gamepad.XBOX360_BACK).isDown?this.swapButtonDown||(this.swapButtonDown=!0,this.players[0].swapGamepad(),this.players[1].swapGamepad()):this.swapButtonDown=!1),this.lastSpawn<this.game.time.now-2e3){this.lastSpawn=this.game.time.now;for(var t=0;1>t;t++)a.gameObjects.push(new o(this.game,540+200*Math.random(),0+200*Math.random())),a.gameObjects.push(new o(this.game,540+200*Math.random(),520+200*Math.random()))}var i=this.game.input.gamepad.pad1.connected&&this.game.input.gamepad.pad1.getButton(Phaser.Gamepad.XBOX360_START).isDown||this.game.input.gamepad.pad2.connected&&this.game.input.gamepad.pad2.getButton(Phaser.Gamepad.XBOX360_START).isDown;return i&&!p.startDown?(p.startDown=i,a.tidyUpMaybe(),console.log(this.game.world.children.length),"controls"):(p.startDown=i,"game")},t}();t.exports=l},function(t,i,e){var s=e(1),a=function(){function t(t,i){this.game=t,this.players=i}return t.prototype.update=function(){this.isGG||(this.players[0].health<=0&&this.showGG("win2"),this.players[1].health<=0&&this.showGG("win1"))},t.prototype.showGG=function(t){this.isGG=!0;var i=new Phaser.Graphics(this.game,0,0);i.beginFill(0,.5),i.drawRect(0,0,1280,720),i.endFill(),s.layerUi.add(i);var e=new Phaser.Sprite(this.game,640,360,t);e.anchor.set(.5),e.scale.set(0),s.layerUi.add(e);var a=new Phaser.Text(this.game,640,570,"Press Start to Continue",{font:"30pt MetalMacabre,fantasy",boundsAlignH:"center",stroke:"white",strokeThickness:6});a.setTextBounds(0,0,0,100),s.layerUi.add(a),a.alpha=0;var o=this.game.add.tween(e.scale).to({x:2,y:2},1e3,"Cubic.easeIn"),r=this.game.add.tween(e.scale).to({x:1.5,y:1.5},1e3,"Cubic.easeOut"),n=this.game.add.tween(a).to({alpha:1},1e3,"Cubic.easeIn");o.chain(r),r.chain(n),o.start(),i.alpha=0,this.game.add.tween(i).to({alpha:1},1e3).start()},t}();t.exports=a},function(t,i,e){var s=e(1),a=function(){function t(t,i,e){this.game=t,this.animation="",this.sprite=s.layerGround.add(new Phaser.Sprite(t,i,e,"sheeple-new")),this.sprite.animations.add("down",[0,1,2,1],4,!0),this.sprite.animations.add("left",[3,4,5,4],4,!0),this.sprite.animations.add("right",[6,7,8,7],4,!0),this.sprite.animations.add("up",[9,10,11,10],4,!0),this.sprite.animations.add("standing",[1],4,!0),this.ensureAnimation("standing"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.shadow=new Phaser.Sprite(t,i,e,"shadow-sheeple"),this.shadow.anchor.x=.5,this.shadow.anchor.y=.5,this.shadow.alpha=.5,s.layerGround.addAt(this.shadow,0),t.physics.p2.enable(this.sprite,!1),this.body=this.sprite.body,this.body.setCircle(20),this.body.damping=.9,this.body.fixedRotation=!0,this.body.setCollisionGroup(s.lambCollisionGroup),this.body.collides([s.playerCollisionGroup,s.lambCollisionGroup,s.pitCollisionGroup,s.groundCreatureCollisionGroup]),this.body.lamb=this}return t.prototype.update=function(){var t=Math.sqrt(this.body.velocity.x*this.body.velocity.x+this.body.velocity.y*this.body.velocity.y);t>2?Math.abs(this.body.velocity.x)>Math.abs(this.body.velocity.y)?this.body.velocity.x>0?this.ensureAnimation("right"):this.ensureAnimation("left"):this.body.velocity.y>0?this.ensureAnimation("down"):this.ensureAnimation("up"):this.ensureAnimation("standing"),this.shadow.angle=this.sprite.angle,this.shadow.x=this.sprite.x,this.shadow.y=this.sprite.y+18},t.prototype.ensureAnimation=function(t){this.animation!=t&&(this.sprite.animations.play(t,4,!0),this.animation=t)},t}();t.exports=a},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},a=e(16),o=e(18),r=e(1),n=e(20),h=e(5),p=e(21),l=e(22),d=e(24),c=e(25),u=function(t){function i(i,e,s,a){var o=this;t.call(this,i,null,100,e),this.game=i,this.id=e,this.gamepadMain=s,this.gamepadAlt=a,this.maxMana=92,this.mana=50,this.followers=[],this.springs=[],this.maxFollowers=1,this.buttonA=!1,this.buttonRightBumper=!1,this.buttonLeftBumper=!1,this.selectedItem=0,this.timeBuildVisible=9999,this.gamepad=this.gamepadMain,r.lambSacrificed.on(function(t){return o.lambSacrificed(t)}),1==e?this.sprite=r.layerGround.add(new Phaser.Sprite(i,100,300,"player"+e)):this.sprite=r.layerGround.add(new Phaser.Sprite(i,1180,300,"player"+e)),this.sprite.animations.add("walk",[0,1,2,1],4,!0),this.sprite.animations.play("walk"),this.sprite.smoothed=!1,this.sprite.scale.set(1.2),this.shadow=new Phaser.Sprite(i,this.sprite.x,this.sprite.y,"shadow-player"),this.shadow.anchor.x=.5,this.shadow.anchor.y=.5,this.shadow.alpha=.5,r.layerGround.addAt(this.shadow,0),this.shadow.scale.set(1.2),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,i.physics.p2.enable(this.sprite),this.body=this.sprite.body,this.body.setMaterial(h.groundUnitMaterial),this.body.player=this,this.body.combatUnit=this,this.body.setCircle(30),this.body.setZeroDamping(),this.body.fixedRotation=!0,this.body.setCollisionGroup(r.playerCollisionGroup),this.body.collides(r.lambCollisionGroup,this.lambCollision,this),this.body.collides([r.playerCollisionGroup,r.pitCollisionGroup,r.groundCreatureCollisionGroup,r.flyingSensorCollisionGroup])}return s(i,t),i.prototype.lambCollision=function(t,i){var e=i.lamb;!e.beingDragged&&this.followers.length<this.maxFollowers&&-1==this.followers.indexOf(e)&&(e.beingDragged=!0,this.followers.push(e),r.soundscape.addScream(),r.soundscape.addAttack(),this.springs.push(this.game.physics.p2.createSpring(t,i,45,100,.7)))},i.prototype.lambSacrificed=function(t){var i=this.followers.indexOf(t);-1!=i&&(this.followers.splice(i,1),this.game.physics.p2.removeSpring(this.springs[i]),this.springs.splice(i,1))},i.prototype.addMana=function(t){t*=2,this.mana+=t,this.mana>this.maxMana&&(this.mana=this.maxMana),this.mana<0&&(this.takeDamage(-this.mana),this.mana=0)},i.prototype.update=function(){this.body.setZeroVelocity(),this.gamepad.connected&&(this.gamepad.deadZone=.1,this.updateControls()),this.addMana(1*this.game.time.physicsElapsed),t.prototype.update.call(this)},i.prototype.updateControls=function(){this.updatePlayerControls(),this.updateBuildControls(),this.timeBuildVisible+=this.game.time.physicsElapsed},i.prototype.updatePlayerControls=function(){var t=this.gamepad.axis(0),i=this.gamepad.axis(1);this.body.moveRight(400*t),this.body.moveDown(400*i),this.rotateSprite(t,i),this.shadow.angle=this.sprite.angle,this.shadow.x=this.sprite.x+3,this.shadow.y=this.sprite.y+3;var e=this.gamepad.getButton(Phaser.Gamepad.XBOX360_A).isDown,s=!this.buttonA&&e;this.buttonA=e,s&&this.tryBuild()},i.prototype.updateBuildControls=function(){var t=this.gamepad.getButton(Phaser.Gamepad.XBOX360_RIGHT_BUMPER).isDown,i=!this.buttonRightBumper&&t;this.buttonRightBumper=t;var e=this.gamepad.getButton(Phaser.Gamepad.XBOX360_LEFT_BUMPER).isDown,s=!this.buttonLeftBumper&&e;this.buttonLeftBumper=e,s&&(this.selectedItem=(this.selectedItem+5)%6,this.timeBuildVisible=0),i&&(this.selectedItem=(this.selectedItem+1)%6,this.timeBuildVisible=0);var a=this.gamepad.axis(2),o=this.gamepad.axis(3),r=Math.sqrt(a*a+o*o);if(r>.5){var n=180*Math.atan2(o,a)/Math.PI;n+=90,n=(n+360)%360,console.log(n);var h=Math.floor((n+30)/60)%6;console.log(h),this.selectedItem=h,this.timeBuildVisible=0}},i.prototype.tryBuild=function(){var t=!1,i=this.sprite.x+70*Math.sin((this.sprite.angle+90)*Math.PI/180),e=this.sprite.y-70*Math.cos((this.sprite.angle+90)*Math.PI/180);switch(this.selectedItem){case 0:this.mana>=30&&(t=!0,this.mana-=30,r.gameObjects.push(new n(this.game,this,i,e)));break;case 1:this.mana>=30&&(t=!0,this.mana-=30,r.gameObjects.push(new d(this.game,this,i+10,e+10)),r.gameObjects.push(new d(this.game,this,i-10,e+10)),r.gameObjects.push(new d(this.game,this,i+10,e-10)),r.gameObjects.push(new d(this.game,this,i-10,e-10)));break;case 2:this.mana>=30&&(t=!0,this.mana-=30,r.gameObjects.push(new p(this.game,this,i,e)));break;case 3:this.mana>=30&&(t=!0,this.mana-=30,r.gameObjects.push(new c(this.game,this,i,e)));break;case 4:this.mana>=30&&(t=!0,this.mana-=30,r.gameObjects.push(new o(this.game,this,i,e)));break;case 5:this.mana>=30&&(t=!0,this.mana-=30,r.gameObjects.push(new l(this.game,this,i,e)))}t&&(this.timeBuildVisible=999)},i.prototype.swapGamepad=function(){if(null!==this.gamepadAlt){var t=this.gamepadMain;this.gamepadMain=this.gamepadAlt,this.gamepadAlt=t,this.gamepad=this.gamepadMain}},i}(a);t.exports=u},function(t,i,e){var s=e(1),a=e(17),o=function(){function t(t,i,e,o){this.graphics=s.layerUi.add(new Phaser.Graphics(t)),this.player=i||this,this.maxHealth=e,this.health=this.maxHealth,this.healthBar=new a(this.graphics,50,7,1,o,!1,2==o,0,0)}return t.prototype.distanceTo=function(t){var i=this.body.x-t.body.x,e=this.body.y-t.body.y;return Math.sqrt(i*i+e*e)},t.prototype.rotateSprite=function(t,i){if(0!=t||0!=i){var e=180*Math.atan2(i,t)/Math.PI;this.sprite.angle=e}},t.prototype.update=function(){this.graphics.clear(),this.graphics.x=this.sprite.x-25,this.graphics.y=this.sprite.y-45,this.healthBar.draw(this.health,this.maxHealth)},t.prototype.takeDamage=function(t){this.health-=t,s.addBloodSplatter(this.sprite.x+30*Math.random()-15,this.sprite.y+30*Math.random()-15,400,1),s.soundscape.addAttack(),this.health<=0&&(this.preDie(),this.sprite.destroy(),this.graphics.destroy(),this.onDead())},t.prototype.preDie=function(){},t.prototype.onDead=function(){},t}();t.exports=o},function(t,i){var e=function(){function t(t,i,e,s,a,o,r,n,h){this.graphics=t,this.width=i,this.height=e,this.radius=s,1==a?o?(this.backColour=4067156,this.frontColour=11286242):(this.backColour=5507109,this.frontColour=15018350):2==a&&(o?(this.backColour=472381,this.frontColour=2667468):(this.backColour=1642592,this.frontColour=4278250)),this.backwards=r,this.x=n,this.y=h}return t.prototype.draw=function(t,i){var e=Math.round(t/i*this.width);0>e&&(e=0);var s=this.radius,a=0;if(e>0&&e<2*this.radius+1&&(s=Math.floor((e-1)/2),a=this.radius-s),this.graphics.beginFill(this.backColour),this.graphics.drawRoundedRect(this.x,this.y,this.width,this.height,this.radius),0!=e){this.graphics.beginFill(this.frontColour);var o=this.backwards?this.x+this.width-e:this.x;1>s?this.graphics.drawRect(o,this.y+a,e,this.height-2*a):this.graphics.drawRoundedRect(o,this.y+a,e,this.height-2*a,s)}},t}();t.exports=e},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},a=e(1),o=e(19),r=function(t){function i(i,e,s,o){t.call(this,i,e,s,o,{size:16,health:20,dps:7,desiredTargetDistance:10,movementForce:30,massMultiplier:1,layer:a.layerFlying,collisionGroup:a.flyingCreatureCollisionGroup,collidesWith:[a.flyingCreatureCollisionGroup,a.flyingSensorCollisionGroup],sprite:"flying"+e.id,shadow:{sprite:"shadow-flying",x:6,y:16}}),this.isFlying=!0,this.body.onBeginContact.remove(this.beginContact,this),this.body.onEndContact.remove(this.endContact,this),this.circleBody=i.physics.p2.createBody(s,o,1);var r=this.circleBody.addCircle(20);r.sensor=!0,i.physics.p2.addBody(this.circleBody),this.circleBody.setCollisionGroup(a.flyingSensorCollisionGroup),this.circleBody.collides([a.flyingCreatureCollisionGroup,a.groundCreatureCollisionGroup,a.playerCollisionGroup]),this.circleBody.onBeginContact.add(this.beginContact,this),this.circleBody.onEndContact.add(this.endContact,this),this.constraint=i.physics.p2.createDistanceConstraint(this.body,this.circleBody,1)}return s(i,t),i.prototype.preDie=function(){this.game.physics.p2.removeConstraint(this.constraint)},i.prototype.onDead=function(){t.prototype.onDead.call(this),this.circleBody.removeFromWorld(),this.circleBody.clearShapes()},i}(o);t.exports=r},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},a=e(16),o=e(1),r=e(5),n=function(t){function i(i,e,s,a,o){t.call(this,i,e,o.health,e.id),this.game=i,this.def=o,this.collidingWith=[],this.sprite=o.layer.add(new Phaser.Sprite(i,s,a,o.sprite)),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,o.shadow&&(this.shadow=new Phaser.Sprite(i,s,a,o.shadow.sprite),this.shadow.anchor.x=.5,this.shadow.anchor.y=.5,this.shadow.alpha=.5,o.layer.addAt(this.shadow,0)),i.physics.p2.enable(this.sprite),this.body=this.sprite.body,this.body.combatUnit=this,o.capsuleLength?(this.body.clearShapes(),this.body.addCapsule(o.capsuleLength,o.size)):this.body.setCircle(o.size),this.body.mass*=o.massMultiplier,this.body.damping=.9999,this.body.fixedRotation=!0,this.body.setMaterial(r.groundUnitMaterial),this.body.setCollisionGroup(o.collisionGroup),this.body.collides(o.collidesWith),this.body.onBeginContact.add(this.beginContact,this),this.body.onEndContact.add(this.endContact,this)}return s(i,t),i.prototype.beginContact=function(t,i){if(t){var e=t.combatUnit;e&&this.player!=e.player&&this.collidingWith.push(e)}},i.prototype.endContact=function(t,i){if(t){var e=t.combatUnit;if(e){var s=this.collidingWith.indexOf(e);s>=0&&this.collidingWith.splice(s,1)}}},i.prototype.update=function(){this.updateCollisionsAndDamage(),this.updateMovement(),this.shadow&&(this.shadow.angle=this.sprite.angle,this.shadow.x=this.sprite.x+this.def.shadow.x,this.shadow.y=this.sprite.y+this.def.shadow.y),t.prototype.update.call(this)},i.prototype.updateCollisionsAndDamage=function(){for(var t=this.collidingWith.length-1;t>=0;t--)this.collidingWith[t].body.sprite&&this.collidingWith[t].body.sprite.alive||this.collidingWith.splice(t,1);if(0!=this.collidingWith.length)for(var i=this.def.dps*this.game.time.physicsElapsed/this.collidingWith.length,t=this.collidingWith.length-1;t>=0;t--){var e=this.collidingWith[t];e.takeDamage(i)}},i.prototype.updateMovement=function(){if(this.target&&!this.target.sprite.alive&&(this.target=null),this.performTargetUpdateIfRequired(),this.target){var t=this.target.body.x-this.body.x,i=this.target.body.y-this.body.y,e=Math.sqrt(t*t+i*i);if(e>this.def.desiredTargetDistance){t/=e,i/=e;var s=this.def.movementForce;this.body.applyForce([-t*s,-i*s],0,0)}this.rotateSprite(-t,-i)}},i.prototype.performTargetUpdateIfRequired=function(){var t=!1;if(this.game.time.now-this.lastTargetCheckTime>500?t=!0:this.target||(t=!0),t){this.lastTargetCheckTime=this.game.time.now;for(var i=9999999999,e=0;e<o.gameObjects.length;e++){var s=o.gameObjects[e];if(s instanceof a){var r=s;if(r.player!=this.player&&this.canAttack(r)){var n=this.distanceTo(r);i>n&&(this.target=r,i=n)}}}}},i.prototype.canAttack=function(t){return this.isFlying?!0:t.isFlying?!1:!0},i.prototype.onDead=function(){t.prototype.onDead.call(this),this.shadow&&this.shadow.destroy()},i}(a);t.exports=n},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},a=e(16),o=e(1),r=e(14),n=function(t){function i(i,e,s,a){var r=this;t.call(this,i,e,20,e.id),this.game=i,o.lambSacrificed.on(function(t){return r.lambSacrificed(t)}),this.sprite=o.layerGround.add(new Phaser.Sprite(i,s,a,"harvester"+e.id)),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.shadow=new Phaser.Sprite(i,s,a,"shadow-harvester"),this.shadow.anchor.x=.5,this.shadow.anchor.y=.5,this.shadow.alpha=.5,o.layerGround.addAt(this.shadow,0),i.physics.p2.enable(this.sprite),this.body=this.sprite.body,this.body.harvester=this,this.body.combatUnit=this,this.body.setCircle(20),this.body.damping=.7,this.body.fixedRotation=!0,this.body.setCollisionGroup(o.groundCreatureCollisionGroup),this.body.collides(o.lambCollisionGroup,this.lambCollision,this),this.body.collides([o.playerCollisionGroup,o.pitCollisionGroup,o.groundCreatureCollisionGroup,o.flyingSensorCollisionGroup])}return s(i,t),i.prototype.lambCollision=function(t,i){var e=i.lamb;this.isDraggingTarget||e.beingDragged||(this.target=e,this.targetSpring=this.game.physics.p2.createSpring(t,i,45,100,.7),this.isDraggingTarget=!0,e.beingDragged=!0)},i.prototype.lambSacrificed=function(t){this.target&&this.target==t&&(t.beingDragged=!1,this.game.physics.p2.removeSpring(this.targetSpring),this.target=null,this.targetSpring=null,this.isDraggingTarget=!1)},i.prototype.update=function(){if((!this.target||!this.target.sprite.alive||!this.isDraggingTarget&&this.target.beingDragged)&&this.findNewTarget(),this.target){var i;i=this.isDraggingTarget?this.player.sacrificePit:this.target;var e=i.body.x-this.body.x,s=i.body.y-this.body.y,a=Math.sqrt(e*e+s*s);e/=a,s/=a;var o=30;this.body.applyForce([-e*o,-s*o],0,0),this.rotateSprite(-e,-s)}this.shadow.angle=this.sprite.angle,this.shadow.x=this.sprite.x+3,this.shadow.y=this.sprite.y+3,t.prototype.update.call(this)},i.prototype.findNewTarget=function(){this.target=null;for(var t=99999999999999,i=0;i<o.gameObjects.length;i++){var e=o.gameObjects[i];if(e instanceof r&&!e.beingDragged){var s=(this.body.x-e.body.x)*(this.body.x-e.body.x)+(this.body.y-e.body.y)*(this.body.y-e.body.y);t>s&&(t=s,this.target=e)}}},i.prototype.onDead=function(){t.prototype.onDead.call(this),this.shadow&&this.shadow.destroy(),this.lambSacrificed(this.target)},i}(a);t.exports=n},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},a=e(1),o=e(19),r=function(t){function i(i,e,s,o){t.call(this,i,e,s,o,{size:20,health:36,dps:16,desiredTargetDistance:0,movementForce:30,massMultiplier:1,layer:a.layerGround,collisionGroup:a.groundCreatureCollisionGroup,collidesWith:[a.lambCollisionGroup,a.playerCollisionGroup,a.pitCollisionGroup,a.groundCreatureCollisionGroup,a.flyingSensorCollisionGroup],sprite:"warrior"+e.id,shadow:{sprite:"shadow-warrior",x:3,y:3}})}return s(i,t),i}(o);t.exports=r},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},a=e(1),o=e(23),r=e(19),n=function(t){function i(i,e,s,o){t.call(this,i,e,s,o,{capsuleLength:30,size:12,health:30,dps:0,desiredTargetDistance:200,movementForce:30,massMultiplier:1,layer:a.layerGround,collisionGroup:a.groundCreatureCollisionGroup,collidesWith:[a.lambCollisionGroup,a.playerCollisionGroup,a.pitCollisionGroup,a.groundCreatureCollisionGroup,a.flyingSensorCollisionGroup],sprite:"thrower"+e.id,shadow:{sprite:"shadow-thrower",x:3,y:3}}),this.shotDamage=2,this.shotSpeed=700,this.shotTime=500,this.lastShot=0}return s(i,t),i.prototype.update=function(){t.prototype.update.call(this),this.target&&this.distanceTo(this.target)<this.def.desiredTargetDistance&&this.lastShot<this.game.time.now-this.shotTime&&(this.lastShot=this.game.time.now,a.shots.push(new o(this.game,this,this.target,this.shotSpeed,this.shotDamage)))},i.prototype.canAttack=function(t){return!0},i}(r);t.exports=n},function(t,i,e){var s=e(1),a=function(){function t(t,i,e,s,a){this.game=t,this.target=e,this.speed=s,this.damage=a,this.sprite=this.game.add.sprite(i.sprite.x,i.sprite.y,"shot"),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5}return t.prototype.update=function(){var t=this.target.sprite.x-this.sprite.x,i=this.target.sprite.y-this.sprite.y,e=Math.sqrt(t*t+i*i);if(10>e)return void this.finish();t/=e,i/=e,this.sprite.x+=t*this.game.time.physicsElapsed*this.speed,this.sprite.y+=i*this.game.time.physicsElapsed*this.speed;var s=180*Math.atan2(i,t)/Math.PI;this.sprite.angle=s},t.prototype.finish=function(){for(var t=20,i=t;i>0;)this.target.takeDamage(this.damage/t),i--;s.shots.splice(s.shots.indexOf(this),1),this.sprite.destroy()},t}();t.exports=a},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)},a=e(1),o=e(19),r=function(t){function i(i,e,s,o){t.call(this,i,e,s,o,{size:10,health:6,dps:5,desiredTargetDistance:0,movementForce:40,massMultiplier:.5,layer:a.layerGround,collisionGroup:a.groundCreatureCollisionGroup,collidesWith:[a.lambCollisionGroup,a.playerCollisionGroup,a.pitCollisionGroup,a.groundCreatureCollisionGroup,a.flyingSensorCollisionGroup],sprite:"spam"+e.id,shadow:{sprite:"shadow-spam",x:2,y:2}}),this.sprite.scale.set(.5),this.shadow.scale.set(.5)}return s(i,t),i}(o);t.exports=r},function(t,i,e){var s=this&&this.__extends||function(t,i){function e(){this.constructor=t}for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,
new e)},a=e(1),o=e(19),r=function(t){function i(i,e,s,o){t.call(this,i,e,s,o,{capsuleLength:40,size:30,health:150,dps:5,desiredTargetDistance:0,movementForce:200,massMultiplier:30,layer:a.layerGround,collisionGroup:a.groundCreatureCollisionGroup,collidesWith:[a.lambCollisionGroup,a.playerCollisionGroup,a.pitCollisionGroup,a.groundCreatureCollisionGroup,a.flyingSensorCollisionGroup],sprite:"tank"+e.id,shadow:{sprite:"shadow-tank",x:3,y:3}})}return s(i,t),i}(o);t.exports=r},function(t,i,e){var s=e(1),a=function(){function t(t,i){this.game=t,this.player=i,i.sacrificePit=this,1==i.id?this.sprite=s.layerGround.add(new Phaser.Sprite(t,50,360,"altar"+i.id)):this.sprite=s.layerGround.add(new Phaser.Sprite(t,1230,360,"altar"+i.id)),this.sprite.animations.add("altarAnim",[0,1,2,1],3,!0),this.sprite.animations.play("altarAnim"),this.sprite.smoothed=!1,this.sprite.scale.set(1.5),this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,t.physics.p2.enable(this.sprite,!1),this.body=this.sprite.body,this.sprite.body.setCircle(50),this.sprite.body["static"]=!0,this.body.setCollisionGroup(s.pitCollisionGroup),this.body.collides(s.playerCollisionGroup,this.playerCollision,this),this.body.collides(s.groundCreatureCollisionGroup,this.groundCreatureCollision,this),this.body.collides([s.playerCollisionGroup,s.lambCollisionGroup,s.flyingSensorCollisionGroup])}return t.prototype.playerCollision=function(t,i){for(var e=i.player,s=e.followers.length-1;s>=0;s--){var a=e.followers[s];this.eatLamb(a)}},t.prototype.groundCreatureCollision=function(t,i){if(i.harvester){var e=i.harvester;e.target&&e.isDraggingTarget&&this.eatLamb(e.target)}},t.prototype.eatLamb=function(t){t.sprite.destroy(),this.player.addMana(10),s.lambSacrificed.trigger(t),s.addBloodSplatter(this.sprite.x,this.sprite.y,1e3,12),s.addSoul(this.sprite.x-12,this.sprite.y-45,this.player.id),s.soundscape.addScream()},t.prototype.update=function(){},t}();t.exports=a},function(t,i,e){var s=e(28),a=e(1),o=function(){function t(t,i){var e=this;this.game=t,this.players=i;var o=new Phaser.Sprite(t,0,0,"healthmanabg1"),n=new Phaser.Sprite(t,1137,0,"healthmanabg2");a.layerUi.add(o),a.layerUi.add(n),this.graphics=this.game.add.graphics(0,0);this.p1ManaSpriteBar=new r(this.game,"manabar",8,3,129,function(){return e.players[0].mana/e.players[0].maxMana}),this.p1HealthSpriteBar=new r(this.game,"healthbar",3,22,96.5,function(){return e.players[0].health/e.players[0].maxHealth}),this.p2ManaSpriteBar=new r(this.game,"manabar",1272,19.5,129,function(){return e.players[1].mana/e.players[1].maxMana}),this.p2ManaSpriteBar.sprite.angle=180,this.p2HealthSpriteBar=new r(this.game,"healthbar",1277,38,96.5,function(){return e.players[1].health/e.players[1].maxHealth}),this.p2HealthSpriteBar.sprite.angle=180,this.p1BuildUi=new s(t,this.players[0]),this.p2BuildUi=new s(t,this.players[1])}return t.prototype.update=function(){this.graphics.clear(),this.p1HealthSpriteBar.update(),this.p1ManaSpriteBar.update(),this.p2HealthSpriteBar.update(),this.p2ManaSpriteBar.update(),this.p1BuildUi.update(),this.p2BuildUi.update()},t}(),r=function(){function t(t,i,e,s,o,r){this.x=e,this.width=o,this.valueGetter=r,this.sprite=new Phaser.Sprite(t,e,s,i),a.layerUi.add(this.sprite)}return t.prototype.update=function(){var t=this.valueGetter(),i=this.width*t;this.sprite.crop(new Phaser.Rectangle(this.width-i,0,i,999),!1)},t}();t.exports=o},function(t,i){var e=function(){function t(t,i){this.player=i,this.itemSprites=[],this.visible=!1,this.game=t,this.group=t.add.group(null);var e=["harvester","spam","warrior","tank","flying","thrower"];this.selectorSprite=t.add.sprite(0,0,"selector"+i.id,void 0,this.group),this.selectorSprite.anchor.x=.5,this.selectorSprite.anchor.y=.35,this.selectorSprite.alpha=.95;for(var s=0;s<e.length;s++){var a=this.getPosition(s),o=t.add.sprite(a.x,a.y,e[s]+i.id,void 0,this.group);o.anchor.x=.5,o.anchor.y=.5,o.alpha=.65,o.scale.set(.5),this.itemSprites.push(o)}this.text=new Phaser.Text(t,-100,-110,"Shooter",{font:"30pt MetalMacabre,fantasy",boundsAlignH:"center",stroke:"#ffffff",strokeThickness:4}),this.text.setTextBounds(0,0,200,50),this.group.add(this.text)}return t.prototype.update=function(){var t=this.player.timeBuildVisible<1;if(t){this.group.x=this.player.sprite.x,this.group.y=this.player.sprite.y;var i=this.getPosition(this.player.selectedItem);this.selectorSprite.x=i.x,this.selectorSprite.y=i.y,this.text.setText(this.getText(this.player.selectedItem))}t!=this.visible&&(this.visible=t,t?this.game.world.add(this.group):this.game.world.remove(this.group))},t.prototype.getText=function(t){switch(t){case 0:return"Harvester";case 1:return"Shoal";case 2:return"Warrior";case 3:return"Tank";case 4:return"Flyer";case 5:return"Thrower"}},t.prototype.getPosition=function(t){var i=t/6*(2*Math.PI)-Math.PI/2,e=60*Math.cos(i),s=60*Math.sin(i);return{x:e,y:s}},t}();t.exports=e},function(t,i,e){var s=e(11),a=function(){function t(t){this.game=t,this.sprite=t.add.sprite(0,0,"splash"),this.createText(),this.initialTextWidth=this.text.width}return t.prototype.createText=function(){this.text=new Phaser.Text(this.game,640,600,"Press Start to Play",{font:"30pt MetalMacabre,fantasy",boundsAlignH:"center",stroke:"white",strokeThickness:6}),this.text.setTextBounds(0,0,0,100),this.sprite.addChild(this.text);var t=this.game.add.tween(this.text.scale).to({x:1.2,y:1.2},500,Phaser.Easing.Cubic.InOut,!1,0,-1,!0);t.start()},t.prototype.update=function(){this.text.width==this.initialTextWidth&&(this.text.destroy(),this.createText());var t=this.game.input.gamepad.pad1.connected&&this.game.input.gamepad.pad1.getButton(Phaser.Gamepad.XBOX360_START).isDown||this.game.input.gamepad.pad2.connected&&this.game.input.gamepad.pad2.getButton(Phaser.Gamepad.XBOX360_START).isDown;return t?(s.startDown=t,"controls"):(s.startDown=t,"splash")},t}();t.exports=a}]);
//# sourceMappingURL=bundle.js.map